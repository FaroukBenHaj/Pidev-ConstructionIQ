<div class="flex justify-content-between flex-column sm:flex-row">
  <!-- Champ de recherche -->
  <span class="p-input-icon-left mb-2">
    <i class="pi pi-search"></i>
    <input 
      pInputText 
      type="text" 
      [(ngModel)]="searchName" 
      (input)="onGlobalFilter(dt1, $event)" 
      placeholder="Search Stock" 
      class="w-full"
    />
  </span>
</div>

<p-table #dt1 [value]="stocks" [loading]="loading" [rows]="10" [paginator]="true" 
         [globalFilterFields]="['availableQuantity', 'dateReceived']" responsiveLayout="scroll">
  <ng-template pTemplate="header">
    <tr>
      <th style="min-width: 12rem" pSortableColumn="availableQuantity">
        <div class="flex justify-content-between align-items-center">
          Available Quantity
          <p-sortIcon field="availableQuantity"></p-sortIcon>
        </div>
      </th>
      <th style="min-width: 12rem" pSortableColumn="dateReceived">
        <div class="flex justify-content-between align-items-center">
          Date Received
          <p-sortIcon field="dateReceived"></p-sortIcon>
        </div>
      </th>
      <th style="min-width: 12rem">Actions</th>
      <th style="min-width: 12rem">DÃ©tails</th> <!-- âœ… Nouvelle colonne -->
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-stock>
    <tr>
      <td>{{ stock.availableQuantity }}</td>
      <td>{{ stock.dateReceived | date:'shortDate' }}</td>
      <td>
        <button 
          pButton 
          icon="pi pi-trash" 
          class="p-button-danger p-button-rounded p-button-outlined"
          (click)="deleteStock(stock.stockID)"
          aria-label="Delete Stock"
        >
          Delete
        </button>

        <button 
          pButton 
          icon="pi pi-pencil" 
          class="p-button-warning p-button-rounded p-button-outlined"
          (click)="editStock(stock)"
          aria-label="Edit Stock"
        >
          Edit
        </button>
      </td>
      <td>
        <button 
          pButton 
          icon="pi pi-eye" 
          label="Afficher" 
          class="p-button-info p-button-rounded p-button-outlined"
          (click)="viewStockDetails(stock)"
        ></button>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="4">No stocks found.</td>
    </tr>
  </ng-template>
</p-table>

<!-- âœ… Ajouter un nouveau stock -->
<button 
  routerLink="/add-stock" 
  pButton 
  icon="pi pi-plus" 
  label="Add New Stock" 
  class="p-button-success p-button-rounded p-button-outlined p-mt-3">
</button>

<!-- âœ… Panneau de dÃ©tails -->


  <div *ngIf="selectedStock" id="stockDetails" class="stock-details p-mt-3 p-p-3 p-shadow-2 border-round surface-card">
    <h3>DÃ©tails du Stock</h3>
    <p><strong>Date :</strong> {{ selectedStock.dateReceived | date:'shortDate' }}</p>
    <p><strong>QuantitÃ© Totale :</strong> {{ selectedStock.availableQuantity }}</p>
  
    <div *ngIf="stockMaterials.length > 0">
      <h4>MatÃ©riaux :</h4>
      <ul class="p-pl-3">
        <li *ngFor="let material of stockMaterials">
          {{ material.materialName }} â€” {{ material.selectedQuantity }} x {{ material.cost }} â‚¬
        </li>
      </ul>
    </div>
  
    <div *ngIf="stockCost !== null" class="p-mt-2">
      <strong>ðŸ’° CoÃ»t total :</strong> {{ stockCost }} â‚¬
    </div>
  
    <!-- âœ… Bouton Imprimer -->
    <button 
      pButton 
      label="Imprimer PDF" 
      icon="pi pi-print" 
      class="p-button-help p-mr-2"
      (click)="printDetails()"
    ></button>
<!-- Dans votre template -->
<a 
  [attr.href]="'http://localhost:5000/api/generate-pdf/' + selectedStock?.stockID" 
  class="p-button p-button-help p-mr-2 pdf-download-link"
  target="_blank"
>
  <i class="pi pi-download p-mr-2"></i>
  RapportStock 
</a>
  
    <button 
      pButton 
      label="Fermer" 
      icon="pi pi-times" 
      class="p-button-secondary p-button-sm p-mt-2"
      (click)="selectedStock = null"
    ></button>
  </div>
  

